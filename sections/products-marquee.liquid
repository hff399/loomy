{% if section.index <= 2 %}
  {{ 'products-marquee.css' | asset_url | preload_tag: as: 'style' }}
{% endif %}
{{ 'products-marquee.css' | asset_url | stylesheet_tag }}

{% liquid
  if section.settings.section_container_width == 'global'
    assign containerClass = settings.container_width
  else
    assign containerClass = section.settings.section_container_width
  endif
%}
{%- capture corner_style -%}
  {% if section.settings.corner_style == 'top' %}
      round-section round-top
      {% elsif section.settings.corner_style == 'bottom' %}
      round-section round-bottom
      {% elsif section.settings.corner_style == 'both' %}
      round-section round-bottom round-top
  {% endif %}
{%- endcapture -%}

<div class="section-wrapper scheme-{{ section.settings.color_scheme }} section-spacing pos-relative {{ corner_style }} section-{{ section.settings.section_background }}">
  {% if section.settings.heading != blank or section.settings.description != blank %}
    <div class="{{ settings.container_width }}">
      <div class="section-header">
        <div class="section-header-content-wrapper text-{{ section.settings.alignment }} m-auto">
          {% if section.settings.heading != blank %}
            <{{ section.settings.seo_heading }} class="section-heading {{ section.settings.heading_font }} {{ section.settings.heading_size }}{% if settings.enable_heading_animation %} animate-element-parent{% endif %}">
            {% if settings.enable_heading_animation %}
                  <animate-element data-animate="fade-up-large" data-animate-delay="50">
                {% endif %}

                {%- capture markersPrefix -%}
                  <span class="markers-text {{ section.settings.markers_font }}">
                {%- endcapture -%} 
                {%- capture markersSuffix -%}
                  </span>
                {%- endcapture -%}

              {{- section.settings.heading | replace: '++', '<br/>'| replace: "[", markersPrefix | replace: "]", markersSuffix -}}

              {% if settings.enable_heading_animation %}
                  </animate-element>
                {% endif %}
            </{{ section.settings.seo_heading }}>
          {% endif %}
          {% if section.settings.description != blank %}
            <div class="section-description{% if settings.enable_heading_animation %} animate-element-parent{% endif %}">
              {% if settings.enable_heading_animation %}
              <animate-element data-animate="fade-up-large" data-animate-delay="100">
              {% endif %}  
              <p class="{{ section.settings.description_size }}">
                {{ section.settings.description | newline_to_br }}
              </p>
              {% if settings.enable_heading_animation %}
                  </animate-element>
                {% endif %}
            </div>
          {% endif %}
        </div>
      </div>
    </div>
  {% endif %}
  <div class="{{ containerClass }}">
    <div class="products-marquee-main-wrapper">
      {% for block in section.blocks %}
        <div
          class="product-marquee-wrapper"
        >
          <swiper-slideshow>
            <div
              class="swiper"
              data-swiper='
                {
                   "spaceBetween": {{ section.settings.marquee_column_gap }},
                    "centeredSlides": true,
                    "speed": {{ block.settings.scrolling_speed_mobile | times: 1000 }},
                    {% if block.settings.products.count > 2 or block.settings.products == blank%}
                      "autoplay": {
                        {% if block.settings.marquee_direction == 'ltr' %}
                          "delay": 0,
                          "reverseDirection": true
                        {% else %}
                          "delay": 0
                        {% endif %}
                      },
                      {% endif %}
                      "loop": true,
                      "slidesPerView":1.2,
                      "allowTouchMove": false,
                      "disableOnInteraction": true,
                      "breakpoints": {
                        "768": {
                          "slidesPerView": 2,
                          {% if block.settings.products.count <= 2 and block.settings.products != blank %}
                          "autoplay":false,
                          "centeredSlides": false,
                          {% endif %}
                          "speed": {{ block.settings.scrolling_speed_mobile | times: 1000 }}
                        },
                      "992": {
                            "slidesPerView": 3,
                            {% if block.settings.products.count <= 3 and block.settings.products != blank %}
                              "autoplay":false,
                              "centeredSlides": false,
                            {% endif %}
                             "speed": {{ block.settings.scrolling_speed | times: 1000 }}
                        },
                        "1280": {
                            "slidesPerView": 4,
                            {% if block.settings.products.count <= 4 and block.settings.products != blank%}
                              "autoplay":false,
                              "centeredSlides": false,
                            {% endif %}
                             "speed": {{ block.settings.scrolling_speed | times: 1000 }}
                        },
                         "1440": {
                            "slidesPerView": 5,
                            {% if block.settings.products.count <= 5 and block.settings.products != blank%}
                              "autoplay":false,
                              "centeredSlides": false,
                            {% endif %}
                             "speed": {{ block.settings.scrolling_speed | times: 1000 }}
                        }
                  }
                }
              '
            >
              <div class="products-marquee-slideshow-wrapper swiper-wrapper">
                {% if block.settings.products != blank %}
                  {% for product in block.settings.products %}
                    <div class="swiper-slide">
                      <div class="products-marquee-item">
                        <a
                          href="{{ product.url }}"
                          aria-label="{{ product.title | escape }}"
                          class="products-marquee-item-image"
                        >
                          <div class="media" style="--image-ratio: 100%;">
                            {% if product.featured_media != blank %}
                              {% render 'lazy-images',
                                image: product.featured_media.preview_image,
                                class: 'collection-image'
                              %}
                            {% else %}
                              {%- assign placeholder_image_index = forloop.index0 | modulo: 4 | plus: 1 -%}
                              {%- assign placeholder_image = 'product-apparel-' | append: placeholder_image_index -%}
                              {{ placeholder_image | placeholder_svg_tag: 'placeholder-svg' }}
                            {% endif %}
                          </div>
                        </a>
                        <div class="products-marquee-item-info">
                          <div class="products-marquee-item-info-content">
                            {% if product.vendor != blank %}
                              <small class="products-marquee-item-vendor">{{ product.vendor }}</small>
                            {% endif %}
                            <h3 class="products-marquee-item-title heading-font {{ block.settings.title_size }}">
                              {{ product.title | escape }}
                            </h3>
                            {% if block.settings.show_product_price %}
                             {% render 'product-card-price'
                              , product: product
                              , section: section
                              , currentVariant: current_variant
                              , source: 'horizontal' %}
                            {% endif %}
                          </div>
                          <div class="col-button-wrap">
                            <a
                              href="{{ product.url }}"
                              class="button media-button button-icon button-sm"
                              aria-label="Product {{ product.title | escape }}"
                            >
                              <svg width="15" height="13" viewBox="0 0 15 13" fill="none">
                                <path d="M0.146659 11.3361L1.12455 12.723L12.5163 4.69029L11.5628 10.2147L13.2392 10.5051L14.6861 2.12213L6.30395 0.669769L6.01458 2.34636L11.5384 3.30346L0.146659 11.3361Z" fill="currentColor"></path>
                              </svg>
                            </a>
                          </div>
                        </div>
                      </div>
                    </div>
                  {% endfor %}
                {% else %}
                  {% for i in (1..6) %}
                    <div class="swiper-slide">
                      <div class="products-marquee-item">
                        <div class="products-marquee-item-image">
                          <div class="media" style="--image-ratio: 100%;">
                            {%- assign placeholder_image_index = forloop.index0 | modulo: 4 | plus: 1 -%}
                            {%- assign placeholder_image = 'product-apparel-' | append: placeholder_image_index -%}
                            {{ placeholder_image | placeholder_svg_tag: 'placeholder-svg' }}
                          </div>
                        </div>
                        <div class="products-marquee-item-info">
                          <div class="products-marquee-item-info-content">
                            <h3 class="products-marquee-item-title heading-font {{ block.settings.title_size }}">
                              {{ 'onboarding.product_title' | t }}
                            </h3>
                            {% if block.settings.show_product_price %}
                             <span class="product-actual-price text-sm">{{ 1999 | money_with_currency }}</span>
                            {% endif %}
                          </div>
                          <div class="col-button-wrap">
                            <button
                              class="button media-button button-icon button-sm"
                              aria-label="Product {{ 'onboarding.product_title' | t }}"
                            >
                              <svg width="15" height="13" viewBox="0 0 15 13" fill="none">
                                <path d="M0.146659 11.3361L1.12455 12.723L12.5163 4.69029L11.5628 10.2147L13.2392 10.5051L14.6861 2.12213L6.30395 0.669769L6.01458 2.34636L11.5384 3.30346L0.146659 11.3361Z" fill="currentColor"></path>
                              </svg>
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>
                  {% endfor %}
                {% endif %}
              </div>
            </div>
          </swiper-slideshow>
        </div>
      {% endfor %}
    </div>
  </div> 
</div>

<style>
    #shopify-section-{{ section.id }}{
      --top-spacing: {{ section.settings.top_space_desktop }}px;
      --bottom-spacing: {{ section.settings.bottom_space_desktop }}px;
      --round-section-radius:{{ section.settings.corner_radius }}px;
      --product-marquee-row-gap: {{ section.settings.marquee_row_gap }}px;
    }
    @media only screen and (max-width:767px) {
      #shopify-section-{{ section.id }}{
        --top-spacing: {{ section.settings.top_space_mobile }}px;
        --bottom-spacing: {{ section.settings.bottom_space_mobile }}px;
      }
    }
    {% if section.settings.section_visibility == 'large' %}
    @media(max-width: 767px) {
      #shopify-section-{{ section.id }} {
        display: none !important;
      }
    }
  {% elsif section.settings.section_visibility == 'small' %}
  @media(min-width: 768px) {
    #shopify-section-{{ section.id }} {
      display: none !important;
    }
  }
  {% endif %}
</style>
{% schema %}
{
  "name": "t:sections.products-marquee.name",
  "tag": "section",
  "class": "products-marquee-section",
  "disabled_on": {
    "groups": ["header", "footer", "custom.Overlay"]
  },
  "settings": [
    {
      "type": "select",
      "id": "section_visibility",
      "label": "t:sections.all.section_visibility.label",
      "default": "always",
      "options": [
        {
          "label": "t:sections.all.section_visibility.always.label",
          "value": "always"
        },
        {
          "label": "t:sections.all.section_visibility.small.label",
          "value": "small"
        },
        {
          "label": "t:sections.all.section_visibility.large.label",
          "value": "large"
        }
      ]
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:sections.all.colors.label",
      "default": "primary"
    },
    {
      "type": "select",
      "id": "section_background",
      "label": "t:sections.all.section_background.label",
      "default": "solid",
      "options": [
        {
          "label": "t:sections.all.section_background.solid.label",
          "value": "solid"
        },
        {
          "label": "t:sections.all.section_background.gradient.label",
          "value": "gradient"
        }
      ]
    },
    {
      "type": "select",
      "id": "section_container_width",
      "label": "t:sections.all.section_container_width.label",
      "default": "no-container",
      "options": [
        {
          "label": "t:sections.all.section_container_width.global.label",
          "value": "global"
        },
        {
          "label": "t:sections.all.section_container_width.container-sm.label",
          "value": "container-sm"
        },
        {
              "label": "t:sections.all.section_container_width.container.label",
              "value": "container-md"
            },
            {
              "label": "t:sections.all.section_container_width.container-md.label",
              "value": "container"
            },
        {
          "label": "t:sections.all.section_container_width.container-fullwidth.label",
          "value": "container-fullwidth"
        },
        {
          "label": "t:sections.all.section_container_width.no-container.label",
          "value": "no-container"
        }
      ]
    },
    {
      "type": "select",
      "id": "corner_style",
      "default": "none",
      "label": "t:sections.all.section_corner_style.label",
      "options": [
        {
          "value": "top",
          "label": "t:sections.all.section_corner_style.top.label"
        },
        {
          "value": "bottom",
          "label": "t:sections.all.section_corner_style.bottom.label"
        },
        {
          "value": "both",
          "label": "t:sections.all.section_corner_style.both.label"
        },
        {
          "value": "none",
          "label": "t:sections.all.section_corner_style.none.label"
        }
      ]
    },
    {
      "type": "range",
      "id": "corner_radius",
      "label": "t:settings_schema.global.settings.corner_radius.label",
      "default": 70,
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "marquee_column_gap",
      "label": "t:sections.products-marquee.settings.marquee_column_gap.label",
      "default": 20,
      "min": 10,
      "max": 50,
      "step": 1,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "marquee_row_gap",
      "label": "t:sections.products-marquee.settings.marquee_row_gap.label",
      "default": 20,
      "min": 10,
      "max": 100,
      "step": 5,
      "unit": "px"
    },
    {
      "type": "header",
      "content": "t:sections.all.headers.content"
    },
    {
      "type": "inline_richtext",
      "id": "heading",
      "label": "t:settings_schema.global.settings.heading.label",
      "default": "Products marquee",
      "info": "t:settings_schema.global.settings.heading.info"
    },
    {
      "type": "select",
      "id": "heading_size",
      "label": "t:sections.all.heading_size.label",
      "default": "h2",
      "options": [
        {
          "value": "h1",
          "label": "t:sections.all.heading_size.h1.label"
        },
        {
          "value": "h2",
          "label": "t:sections.all.heading_size.h2.label"
        },
        {
          "value": "h3",
          "label": "t:sections.all.heading_size.h3.label"
        },
        {
          "value": "h4",
          "label": "t:sections.all.heading_size.h4.label"
        },
        {
          "value": "h5",
          "label": "t:sections.all.heading_size.h5.label"
        },
        {
          "value": "h6",
          "label": "t:sections.all.heading_size.h6.label"
        }
      ]
    },
    {
      "type": "select",
      "id": "seo_heading",
      "label": "t:sections.all.seo_heading.label",
      "info": "t:sections.all.seo_heading.info",
      "default": "h2",
      "options": [
        {
          "value": "h1",
          "label": "H1"
        },
        {
          "value": "h2",
          "label": "H2"
        },
        {
          "value": "h3",
          "label": "H3"
        },
        {
          "value": "h4",
          "label": "H4"
        },
        {
          "value": "h5",
          "label": "H5"
        },
        {
          "value": "h6",
          "label": "H6"
        },
        {
          "value": "div",
          "label": "div"
        },
        {
          "value": "span",
          "label": "span"
        },
        {
          "value": "p",
          "label": "p"
        }
      ]
    },
    {
      "type": "select",
      "id": "heading_font",
      "default": "heading-font",
      "label": "t:sections.all.heading_font.label",
      "options": [
        {
          "value": "heading-font",
          "label": "t:sections.all.heading_font.heading-font.label"
        },
        {
          "value": "body-font",
          "label": "t:sections.all.heading_font.body-font.label"
        },
        {
          "value": "accent-font",
          "label": "t:sections.all.heading_font.accent-font.label"
        }
      ]
    },
    {
      "type": "select",
      "id": "markers_font",
      "default": "accent-font",
      "label": "t:sections.all.markers_font.label",
      "options": [
        {
          "value": "heading-font",
          "label": "t:sections.all.markers_font.heading-font.label"
        },
        {
          "value": "body-font",
          "label": "t:sections.all.markers_font.body-font.label"
        },
        {
          "value": "accent-font",
          "label": "t:sections.all.markers_font.accent-font.label"
        }
      ]
    },
    {
      "type": "textarea",
      "id": "description",
      "label": "t:settings_schema.global.settings.description.label",
      "default": "Add short description for this section."
    },
    {
      "type": "select",
      "id": "description_size",
      "label": "t:sections.all.description_size.label",
      "default": "text",
      "options": [
        {
          "label": "t:sections.all.description_size.text-xsmall.label",
          "value": "text-xs"
        },
        {
          "label": "t:sections.all.description_size.text-small.label",
          "value": "text-sm"
        },
        {
          "label": "t:sections.all.description_size.text.label",
          "value": "text"
        },
        {
          "label": "t:sections.all.description_size.text-medium.label",
          "value": "text-md"
        },
        {
          "label": "t:sections.all.description_size.text-large.label",
          "value": "text-lg"
        },
        {
          "label": "t:sections.all.description_size.text-xlarge.label",
          "value": "text-xl"
        }
      ]
    },
    {
      "type": "text_alignment",
      "id": "alignment",
      "label": "t:sections.best-categories.settings.content_alignment.label",
      "default": "center"
    },
    {
      "type": "header",
      "content": "t:sections.all.spacing.section_spacing_heading"
    },
    {
      "type": "range",
      "id": "top_space_desktop",
      "label": "t:sections.all.spacing.top_space_desktop",
      "default": 70,
      "min": 0,
      "max": 150,
      "step": 5
    },
    {
      "type": "range",
      "id": "bottom_space_desktop",
      "label": "t:sections.all.spacing.bottom_space_desktop",
      "default": 70,
      "min": 0,
      "max": 150,
      "step": 5
    },
    {
      "type": "range",
      "id": "top_space_mobile",
      "label": "t:sections.all.spacing.top_space_mobile",
      "default": 40,
      "min": 0,
      "max": 100,
      "step": 5
    },
    {
      "type": "range",
      "id": "bottom_space_mobile",
      "label": "t:sections.all.spacing.bottom_space_mobile",
      "default": 40,
      "min": 0,
      "max": 100,
      "step": 5
    }
  ],
  "blocks": [
    {
      "type": "products",
      "name": "t:sections.products-marquee.blocks.products.name",
      "limit": 3,
      "settings": [
        {
          "type": "product_list",
          "id": "products",
          "label": "t:sections.products-marquee.blocks.products.settings.products.label"
        },
        {
          "type": "checkbox",
          "id": "show_product_price",
          "label": "t:sections.products-marquee.blocks.products.settings.show_product_price.label",
          "default": false
        },
        {
          "type": "select",
          "id": "title_size",
          "label": "t:sections.all.heading_size.label",
          "default": "text",
          "options": [
            {
              "label": "t:sections.all.description_size.text-xsmall.label",
              "value": "text-xs"
            },
            {
              "label": "t:sections.all.description_size.text-small.label",
              "value": "text-sm"
            },
            {
              "label": "t:sections.all.description_size.text.label",
              "value": "text"
            },
            {
              "label": "t:sections.all.description_size.text-medium.label",
              "value": "text-md"
            },
            {
              "label": "t:sections.all.description_size.text-large.label",
              "value": "text-lg"
            },
            {
              "label": "t:sections.all.description_size.text-xlarge.label",
              "value": "text-xl"
            }
          ]
        },
        {
          "type": "select",
          "id": "marquee_direction",
          "default": "rtl",
          "label": "t:sections.all.marquee_direction.label",
          "options": [
            {
              "value": "rtl",
              "label": "t:sections.all.marquee_direction.rtl.label"
            },
            {
              "value": "ltr",
              "label": "t:sections.all.marquee_direction.ltr.label"
            }
          ]
        },
        {
          "type": "range",
          "id": "scrolling_speed",
          "label": "t:sections.products-marquee.blocks.products.settings.scrolling_speed.label",
          "min": 5,
          "max": 20,
          "step": 1,
          "unit": "s",
          "default": 15
        },
        {
          "type": "range",
          "id": "scrolling_speed_mobile",
          "label": "t:sections.products-marquee.blocks.products.settings.scrolling_speed_mobile.label",
          "min": 5,
          "step": 1,
          "max": 15,
          "unit": "s",
          "default": 10
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "t:sections.products-marquee.presets.name",
      "blocks": [
        {
          "type": "products"
        },
        {
          "type": "products",
          "settings": {
            "marquee_direction": "ltr"
          }
        },
        {
          "type": "products"
        }
      ]
    }
  ]
}
{% endschema %}
