{%- liquid
  assign variant_quantity = currentVariant.inventory_quantity
  assign lowstatus = false
  assign hide_inventory_status = false
  if variant_quantity > 0 and variant_quantity <= block.settings.minimun_inventory and currentVariant.inventory_policy == 'deny'
    assign lowstatus = true
  endif
  if variant_quantity <= 0
    assign hide_inventory_status = true
  endif
  assign check_against_inventory = true
  if currentVariant.inventory_management != 'shopify'
    assign check_against_inventory = false
  endif
  if currentVariant.quantity_rule.min > currentVariant.inventory_quantity and check_against_inventory
    assign quantity_rule_soldout = true
  endif

  assign status_class = 'in-stock'
  if hide_inventory_status
    if currentVariant.inventory_policy == 'continue' or check_against_inventory == false
      assign status_class = 'in-stock'
    else
      assign status_class = 'sold-out'
    endif
  elsif lowstatus
    assign status_class = 'low-stock'
  elsif currentVariant.available == false or quantity_rule_soldout
    if currentVariant.inventory_policy == 'continue'
      assign status_class = 'in-stock'
    else
      assign status_class = 'sold-out'
    endif
  endif
-%}

<div
  class="product-inventory{% if lowstatus == true %} low-inventory{% else %} full-inventory{% endif %} {{ check_against_inventory }}"
  data-product-inventory-bar-wrapper
  id="product-inventory-wrapper-{{ section.id }}"
  {{ block.shopify_attributes }}>
  <span class="product-inventory-text text-xs {{ status_class }} {{ currentVariant.inventory_policy  }}">
    <span></span>
    {% liquid
      if lowstatus
        assign low_inventory_content = variant_quantity | prepend: '<strong>' | append: '</strong>'
        echo block.settings.inventory_less_status | replace: '[inventory]', low_inventory_content
      elsif hide_inventory_status == true
        if currentVariant.inventory_policy == 'continue' or check_against_inventory == false
          echo block.settings.inventory_available_status
        else
          echo block.settings.inventory_unavailable_status
        endif
      else
        echo block.settings.inventory_available_status
      endif
    -%}
  </span>
</div>